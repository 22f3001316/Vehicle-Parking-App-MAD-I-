{% extends 'base.html' %}

{% block navbar %}
<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
  <div class="container">
    <a class="navbar-brand font-weight-bold text-white" href="{{ url_for('admin_dashboard') }}">Admin Panel</a>
    <div class="collapse navbar-collapse justify-content-end">
      <ul class="navbar-nav text-center">
        <li class="nav-item"><a class="nav-link" href="{{ url_for('admin_dashboard') }}">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('view_all_users') }}">Users</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('search') }}">Search</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('admin_summary') }}">Summary</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('edit_admin_profile') }}">Edit Profile</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('logout') }}">Logout</a></li>
      </ul>
    </div>
  </div>
</nav>
{% endblock %}

{% block content %}
<div class="container-fluid mt-5 pt-4">
  <div class="text-center font-weight-bold py-3 shadow" style="background-color: #7fffd4;">
    <h3>Administrative Summary</h3>
  </div>

  <div class="row mt-4">
    <div class="col-md-6">
      <div class="card shadow-sm p-3">
        <h5 class="text-center mb-3">Revenue by Parking Lot</h5>
        <canvas id="revenueChart"></canvas>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card shadow-sm p-3">
        <h5 class="text-center mb-3">Spot Availability Overview</h5>
        <canvas id="occupancyChart"></canvas>
      </div>
    </div>
  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  const lotLabels = {{ lot_names | tojson }};
  const revenueData = {{ revenues | tojson }};
  const occupancyData = {{ [total_available, total_occupied] | tojson }};

  // Doughnut Chart for Revenue
  new Chart(document.getElementById("revenueChart"), {
    type: 'doughnut',
    data: {
      labels: lotLabels,
      datasets: [{
        data: revenueData,
        backgroundColor: ['#2ecc71', '#3498db', '#f1c40f', '#9b59b6', '#e74c3c']
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: 'bottom' }
      }
    }
  });

  // Bar Chart for Availability vs Occupied
  new Chart(document.getElementById("occupancyChart"), {
    type: 'bar',
    data: {
      labels: ['Available', 'Occupied'],
      datasets: [{
        data: occupancyData,
        backgroundColor: ['#27ae60', '#c0392b']
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false }
      },
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
</script>
{% endblock %}
